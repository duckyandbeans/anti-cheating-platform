<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Exam Portal</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .error { color: #ef4444; display: none; margin-top: 10px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="login-card">
        <h1>üîê Exam Login</h1>
        <select id="sClass">
            <option value="">Select Class...</option>
            <option value="XI D">XI D</option>
            <option value="XI E">XI E</option>
            <option value="XI H">XI H</option>
            <option value="XI I">XI I</option>
        </select>
        <input type="number" id="sNo" placeholder="Attendance Number">
        <input type="text" id="sName" placeholder="Full Name">
        <input type="tel" id="accessCode" placeholder="Teacher Code (4 Digits)" style="text-align:center; font-size:1.2rem; letter-spacing:3px;">
        <button onclick="attemptLogin()">Enter</button>
        <div id="errorMsg" class="error"></div>
    </div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAB_on0WAobEXccxHvcwtS9ShxQpfATH-A",
      authDomain: "anti-cheating-remedial-quiz.firebaseapp.com",
      projectId: "anti-cheating-remedial-quiz",
      storageBucket: "anti-cheating-remedial-quiz.firebasestorage.app",
      messagingSenderId: "979294386230",
      appId: "1:979294386230:web:7f9ff3e377d4da20cd4097"
    };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}
function loginStudent() {
    // 1. Get the values from your input fields
    // (Make sure your HTML inputs have these IDs, e.g., id="studentName")
    var name = document.getElementById("studentName").value;
    var studentClass = document.getElementById("studentClass").value;

    // 2. Validation: Make sure they actually typed something
    if (name.trim() === "" || studentClass.trim() === "") {
        alert("Please enter your name and class.");
        return;
    }

    // 3. Save to Local Storage
    // This stores the data in the browser indefinitely
    localStorage.setItem("xitp_student_name", name);
    localStorage.setItem("xitp_student_class", studentClass);

    // 4. Redirect to the quiz selection or first quiz
    window.location.href = "xitp1.html"; 
}
    async function attemptLogin() {
        const cls = document.getElementById('sClass').value;
        const no = document.getElementById('sNo').value;
        const name = document.getElementById('sName').value;
        const code = document.getElementById('accessCode').value;
        const err = document.getElementById('errorMsg');

        if(!cls || !no || !name || !code) return showErr("Fill all fields.");

        try {
            const doc = await db.collection('active_exam_codes').doc(code).get();
            if (!doc.exists) return showErr("Invalid Code.");
            
            const data = doc.data();
            if (Date.now() - data.timestamp > 3600000) return showErr("Code Expired.");

            // SAVE DATA
            sessionStorage.setItem('student_class', cls);
            sessionStorage.setItem('student_no', no);
            sessionStorage.setItem('student_name', name);
            sessionStorage.setItem('exam_code', code); // <--- CRITICAL: Save Code

            window.location.href = data.targetFile;

        } catch (e) { showErr(e.message); }
    }
    
    function showErr(msg) { document.getElementById('errorMsg').innerText = msg; document.getElementById('errorMsg').style.display='block'; }
</script>
</body>
</html>
