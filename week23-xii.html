<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 23: Grammar Dialogues (XII)</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50c878;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --past-color: #e67e22;
            --present-color: #2980b9;
            --advanced-color: #8e44ad; /* Purple for Advanced */
            --danger: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        /* --- LOGIN OVERLAY --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }

        .login-box {
            background: white; padding: 40px; border-radius: 12px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 25px rgba(0,0,0,0.2);
        }

        .login-box h2 { color: #2c3e50; margin-bottom: 20px; }

        select, input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #bdc3c7; border-radius: 6px;
            font-size: 1rem; box-sizing: border-box;
        }

        button.btn-login {
            width: 100%; padding: 12px; background: var(--primary-color); color: white;
            border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        button.btn-login:hover { background: #357abd; }

        /* --- MAIN CONTAINER --- */
        #main-content { display: none; padding: 20px; }

        .container {
            max-width: 800px; margin: 0 auto; background: white;
            padding: 40px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        p.intro { text-align: center; color: #7f8c8d; margin-bottom: 20px; }

        /* ADVANCED MODE TOGGLE */
        .mode-toggle-container { text-align: center; margin-bottom: 30px; }
        .btn-advanced {
            background: linear-gradient(135deg, #8e44ad, #c0392b);
            color: white; border: none; padding: 10px 25px;
            border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s;
        }
        .btn-advanced:hover { transform: scale(1.05); }

        /* Tense Sections */
        .tense-section { margin-bottom: 50px; border-top: 2px solid #eee; padding-top: 20px; }
        .tense-header { font-size: 1.8em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid; display: inline-block; }
        
        .present-header { color: var(--present-color); border-color: var(--present-color); }
        .past-header { color: var(--past-color); border-color: var(--past-color); }
        .advanced-header { color: var(--advanced-color); border-color: var(--advanced-color); }

        /* Dialogue Sets */
        .dialogue-set { background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 40px; overflow: hidden; }
        .set-info { background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; }
        .set-title { font-weight: bold; font-size: 1.2em; color: #2c3e50; margin: 0; }
        .set-usage { font-size: 0.9em; color: #666; margin-top: 5px; font-style: italic; }
        
        .dialogue-content { padding: 20px; display: flex; flex-direction: column; gap: 10px; }

        /* Speech Bubbles */
        .line { max-width: 80%; padding: 10px 15px; border-radius: 15px; position: relative; font-size: 0.95em; }
        .speaker-a { align-self: flex-start; background-color: #e3f2fd; color: #0d47a1; border-bottom-left-radius: 2px; }
        .speaker-a::before { content: "A"; position: absolute; top: -20px; left: 5px; font-size: 0.75em; font-weight: bold; color: #1976d2; }
        .speaker-b { align-self: flex-end; background-color: #e8f5e9; color: #1b5e20; border-bottom-right-radius: 2px; text-align: right; }
        .speaker-b::before { content: "B"; position: absolute; top: -20px; right: 5px; font-size: 0.75em; font-weight: bold; color: #388e3c; }
        
        strong { font-weight: 600; }
        
        /* Advanced Grammar Highlight */
        .gl { color: var(--advanced-color); font-weight: 700; background: #f3e5f5; padding: 0 4px; border-radius: 4px; }

        /* --- ANTI-CHEAT UI --- */
        #cheat-alert {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(220, 38, 38, 0.95); color: white; z-index: 20000;
            display: none; justify-content: center; align-items: center;
            flex-direction: column; text-align: center;
        }
        #cheat-counter {
            position: fixed; top: 10px; right: 10px;
            background: rgba(255, 255, 255, 0.9); padding: 5px 15px;
            border-radius: 20px; border: 2px solid var(--danger);
            color: var(--danger); font-weight: bold; font-family: 'Segoe UI', sans-serif;
            font-size: 0.9rem; display: none; z-index: 9000;
        }
        .watermark {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5000; opacity: 0.03;
            display: flex; flex-wrap: wrap; overflow: hidden;
        }
        .wm-text { transform: rotate(-30deg); margin: 50px; font-weight: 900; font-size: 24px; color: black; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
</head>
<body oncontextmenu="return false;">

    <div id="cheat-alert">
        <div style="font-size: 5rem;">‚ö†Ô∏è</div>
        <h1>FOCUS LOST</h1>
        <p>Please return to the reading material.</p>
        <button onclick="dismissCheatAlert()" style="padding: 10px 20px; font-size: 1.2rem; border: none; background: white; color: red; font-weight: bold; cursor: pointer; border-radius: 6px; margin-top: 20px;">I'm Back</button>
    </div>
    <div id="cheat-counter">OFFENSES: 0</div>
    <div class="watermark" id="watermark"></div>

    <div id="login-overlay">
        <div class="login-box">
            <h2>üìö Grammar Login</h2>
            <select id="sClass">
                <option value="">Select Class...</option>
                <option value="XII D">XII D</option>
                <option value="XII E">XII E</option>
                <option value="XII H">XII H</option>
                <option value="XII I">XII I</option>
            </select>
            <input type="number" id="sNo" placeholder="Attendance Number">
            <input type="text" id="sName" placeholder="Full Name">
            <button class="btn-login" onclick="attemptLogin()">Start Session</button>
            <p id="error-msg" style="color: red; display: none; margin-top: 10px; font-size: 0.9rem;">Please fill all fields.</p>
        </div>
    </div>

    <div id="main-content">
        <div class="container">
            <h1>Context-Based Grammar</h1>
            <p class="intro">Read the dialogues aloud. Use the button below to toggle difficulty.</p>

            <div class="mode-toggle-container">
                <button class="btn-advanced" onclick="toggleMode()">üî• Toggle Advanced Mode</button>
            </div>

            <div id="standard-mode">
                <div class="tense-section">
                    <h2 class="tense-header present-header">Part 1: The Present Tenses</h2>
                    <div class="dialogue-set">
                        <div class="set-info">
                            <h3 class="set-title">Set 1: Simple Present Tense</h3>
                            <div class="set-usage">Topic: Video Games & Free Time</div>
                        </div>
                        <div class="dialogue-content">
                            <div class="line speaker-a">Do you play <em>Mobile Legends</em> every day?</div>
                            <div class="line speaker-b">No, I usually play only on weekends.</div>
                            <div class="line speaker-a">I play every single night, so I am always tired.</div>
                            <div class="line speaker-b">That sounds unhealthy.</div>
                        </div>
                    </div>
                    <div class="dialogue-set">
                        <div class="set-info"><h3 class="set-title">Set 2: Present Continuous</h3><div class="set-usage">Topic: Currently Busy</div></div>
                        <div class="dialogue-content">
                            <div class="line speaker-a">Are you busy right now?</div>
                            <div class="line speaker-b">Yes, I am jogging at the park.</div>
                            <div class="line speaker-a">Oh, I am sitting at a cafe and drinking coffee.</div>
                        </div>
                    </div>
                </div>

                <div class="tense-section">
                    <h2 class="tense-header past-header">Part 2: The Past Tenses</h2>
                    <div class="dialogue-set">
                        <div class="set-info"><h3 class="set-title">Set 5: Simple Past</h3><div class="set-usage">Topic: The Weekend Trip</div></div>
                        <div class="dialogue-content">
                            <div class="line speaker-a">Where did you go last Saturday?</div>
                            <div class="line speaker-b">I went to the beach with my cousins.</div>
                            <div class="line speaker-a">Did you swim in the ocean?</div>
                            <div class="line speaker-b">Yes, we swam for hours.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="advanced-mode" style="display: none;">
                <div class="tense-section">
                    <h2 class="tense-header advanced-header">Part 3: Advanced Grammar</h2>

                    <div class="dialogue-set">
                        <div class="set-info">
                            <h3 class="set-title">Set 9: Reported Speech</h3>
                            <div class="set-usage"><strong>Usage:</strong> Telling someone what another person said (Backshifting tenses).<br><strong>Topic:</strong> Gossip & Messages</div>
                        </div>
                        <div class="dialogue-content">
                            <div class="line speaker-a">Did you speak to the manager about the holiday?</div>
                            <div class="line speaker-b">Yes. He said that <span class="gl">he was considering</span> our request.</div>
                            <div class="line speaker-a">"Considering"? Yesterday he told me <span class="gl">he loved</span> the idea!</div>
                            <div class="line speaker-b">Well, today he told me that <span class="gl">we had to finish</span> the project first.</div>
                            <div class="line speaker-a">That's annoying. Did he say when the deadline was?</div>
                            <div class="line speaker-b">He said that <span class="gl">it was</span> next Monday.</div>
                            <div class="line speaker-a">I thought he said <span class="gl">we could submit</span> it on Tuesday!</div>
                            <div class="line speaker-b">He changed his mind. He also asked <span class="gl">if we were working</span> overtime tonight.</div>
                            <div class="line speaker-a">I told him <span class="gl">I couldn't stay</span> late.</div>
                            <div class="line speaker-b">Good for you. He claimed that <span class="gl">everyone was staying</span>, but that's a lie.</div>
                        </div>
                    </div>

                    <div class="dialogue-set">
                        <div class="set-info">
                            <h3 class="set-title">Set 10: Passive Voice</h3>
                            <div class="set-usage"><strong>Usage:</strong> Focusing on the action or object, not the person doing it.<br><strong>Topic:</strong> Crime & Mystery</div>
                        </div>
                        <div class="dialogue-content">
                            <div class="line speaker-a">Did you hear about the bank robbery?</div>
                            <div class="line speaker-b">Yes! It <span class="gl">was robbed</span> late last night.</div>
                            <div class="line speaker-a">That's crazy. <span class="gl">Was any money taken</span>?</div>
                            <div class="line speaker-b">Millions <span class="gl">were stolen</span> from the vault.</div>
                            <div class="line speaker-a">How did they get in? <span class="gl">Was the door broken</span>?</div>
                            <div class="line speaker-b">No, the security system <span class="gl">had been hacked</span> remotely.</div>
                            <div class="line speaker-a">Wow. <span class="gl">Have the thieves been caught</span> yet?</div>
                            <div class="line speaker-b">Not yet. The evidence <span class="gl">is being analyzed</span> right now by the police.</div>
                            <div class="line speaker-a">It sounds like a movie.</div>
                            <div class="line speaker-b">It does. It <span class="gl">is believed</span> that it was an inside job.</div>
                            <div class="line speaker-a">I hope the money <span class="gl">is recovered</span> soon.</div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyAB_on0WAobEXccxHvcwtS9ShxQpfATH-A",
          authDomain: "anti-cheating-remedial-quiz.firebaseapp.com",
          projectId: "anti-cheating-remedial-quiz",
          storageBucket: "anti-cheating-remedial-quiz.firebasestorage.app",
          messagingSenderId: "979294386230",
          appId: "1:979294386230:web:7f9ff3e377d4da20cd4097"
        };
        try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

        const COLLECTION_NAME = "week23xii";
        let cheatCount = 0;
        let sessionActive = false;
        let wakeLock = null;
        let currentDocID = null;

        // --- WATERMARK ---
        (function() {
            const wm = document.getElementById('watermark');
            let html = ""; for(let i=0; i<40; i++) html += `<div class="wm-text">READING MODE</div>`;
            wm.innerHTML = html;
        })();

        // --- TOGGLE ADVANCED MODE ---
        function toggleMode() {
            const standard = document.getElementById('standard-mode');
            const advanced = document.getElementById('advanced-mode');
            
            if (standard.style.display === 'none') {
                standard.style.display = 'block';
                advanced.style.display = 'none';
            } else {
                standard.style.display = 'none';
                advanced.style.display = 'block';
            }
        }

        // --- LOGIN LOGIC ---
        async function attemptLogin() {
            const cls = document.getElementById('sClass').value;
            const no = document.getElementById('sNo').value;
            const name = document.getElementById('sName').value;
            const errorMsg = document.getElementById('error-msg');

            if (!cls || !no || !name) {
                errorMsg.style.display = 'block';
                return;
            }

            // Create Session in Database
            currentDocID = `${cls.replace(/\s/g,'')}_${no}_${name.replace(/\s/g,'_')}`;
            
            try {
                await db.collection(COLLECTION_NAME).doc(currentDocID).set({
                    name: name,
                    class: cls,
                    number: no,
                    start_time: new Date().toLocaleString(),
                    status: "READING_DIALOGUES",
                    cheat_count: 0
                }, { merge: true });
            } catch(e) {
                console.error("DB Error", e);
            }

            // SUCCESS UI UPDATE
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('cheat-counter').style.display = 'block';
            
            // Activate Systems
            requestWakeLock();
            setTimeout(() => { sessionActive = true; }, 2000); 
            document.documentElement.requestFullscreen().catch(e => console.log(e));
        }

        // --- WAKE LOCK ---
        async function requestWakeLock() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                document.addEventListener('visibilitychange', async () => {
                    if (wakeLock !== null && document.visibilityState === 'visible') {
                        wakeLock = await navigator.wakeLock.request('screen');
                    }
                });
            } catch (err) { console.error(err); }
        }

        // --- ANTI-CHEAT SYSTEM ---
        function triggerCheat() {
            if (!sessionActive) return;
            
            cheatCount++;
            document.getElementById('cheat-counter').innerText = `OFFENSES: ${cheatCount}`;
            document.getElementById('cheat-alert').style.display = 'flex';

            if(currentDocID) {
                db.collection(COLLECTION_NAME).doc(currentDocID).update({ cheat_count: cheatCount });
            }
        }

        function dismissCheatAlert() {
            document.getElementById('cheat-alert').style.display = 'none';
        }

        document.addEventListener("visibilitychange", () => {
            if (document.visibilityState === 'hidden') triggerCheat();
        });

        window.addEventListener("blur", () => {
            triggerCheat();
        });

    </script>
</body>
</html>
